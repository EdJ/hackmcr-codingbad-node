<!DOCTYPE html>
<html>

<head>
    <title>Travelator</title>
    <link href="css/travelator.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/preloadjs-NEXT.min.js"></script>
    <script type="text/javascript" src="js/createjs/events/Event.js"></script>
    <script type="text/javascript" src="js/createjs/events/EventDispatcher.js"></script>
    <script type="text/javascript" src="js/createjs/utils/IndexOf.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/UID.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/Ticker.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Matrix2D.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Point.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Rectangle.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Shadow.js"></script>
    <script type="text/javascript" src="js/easeljs/display/SpriteSheet.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Graphics.js"></script>
    <script type="text/javascript" src="js/easeljs/display/DisplayObject.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Container.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Stage.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Bitmap.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Sprite.js"></script>
    <script type="text/javascript" src="js/easeljs/display/BitmapAnimation.js"></script>
    <script type="text/javascript" src="js/easeljs/display/BitmapText.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Shape.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Text.js"></script>
    <script type="text/javascript" src="js/easeljs/display/DOMElement.js"></script>
    <script type="text/javascript" src="js/easeljs/events/MouseEvent.js"></script>
    <script type="text/javascript" src="js/easeljs/filters/Filter.js"></script>
    <script type="text/javascript" src="js/easeljs/ui/ButtonHelper.js"></script>
    <script type="text/javascript" src="js/easeljs/ui/Touch.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/SpriteSheetUtils.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/SpriteSheetBuilder.js"></script>

    <script type="text/javascript">
    var stage;
    var loader;
    var canvas;
    var viewport;
    var loader;

    var plane = {};

    var Entity = function Entity() {};
    Entity.prototype.setVelocity = function (newVelocity) {
        this._velocity = newVelocity;
    };

    Entity.prototype.update = function () {
        this.asset.x = this.asset.x + this._velocity.x;
        this.asset.y = this.asset.y + this._velocity.y;
    };

    var setupGame = function(stage) {
        canvas = stage.canvas;

        canvas = document.getElementById("travelatorCanvas");
        viewport = {
            dimensions: {
                x: window.innerWidth,
                y: window.innerHeight
            }
        };

        canvas.width = viewport.dimensions.x - 5;
        canvas.height = viewport.dimensions.y - 5;
    };

    var loadAssets = function(handleComplete) {
        var manifest = [{
            src: 'images/plane2small.png',
            id: 'plane'
        }];

        loader = new createjs.LoadQueue(false);
        loader.addEventListener('complete', handleComplete);
        loader.loadManifest(manifest);
    };

    var createPlane = function () {
        var plane = new Entity();

        var asset = plane.asset = new createjs.Bitmap(loader.getResult('plane'));
        asset.setTransform(viewport.dimensions.x - 100, 90, 0.8, 0.8);

        stage.addChild(asset);

        plane.setVelocity({
            x: -1,
            y: 0
        });

        return plane;
    };

    var onTick = function (event) {
        plane.update();

        stage.update(event);
    };

    function init() {
        stage = new createjs.Stage("travelatorCanvas");
        setupGame(stage);

        loadAssets(function() {
            var square = new createjs.Shape();

            square.graphics.beginFill("#000000").drawRect(0, 0, viewport.dimensions.x, viewport.dimensions.y);

            stage.addChild(square);

            plane = createPlane();

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
            createjs.Ticker.addEventListener('tick', onTick);
        });
    }
    </script>
</head>

<body onload="init();">
    <div>
        <canvas id="travelatorCanvas"></canvas>

        <script src="/socket.io/socket.io.js"></script>
        <script>
        var socket = io.connect('http://localhost');
        socket.on('news', function(data) {
            console.log(data);
            socket.emit('my other event', {
                my: 'data'
            });
        });
        </script>
    </div>
</body>

</html>
