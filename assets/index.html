<!DOCTYPE html>
<html>

<head>
    <title>Travelator</title>
    <link href="css/travelator.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/preloadjs-NEXT.min.js"></script>
    <script type="text/javascript" src="js/createjs/events/Event.js"></script>
    <script type="text/javascript" src="js/createjs/events/EventDispatcher.js"></script>
    <script type="text/javascript" src="js/createjs/utils/IndexOf.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/UID.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/Ticker.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Matrix2D.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Point.js"></script>
    <script type="text/javascript" src="js/easeljs/geom/Rectangle.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Shadow.js"></script>
    <script type="text/javascript" src="js/easeljs/display/SpriteSheet.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Graphics.js"></script>
    <script type="text/javascript" src="js/easeljs/display/DisplayObject.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Container.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Stage.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Bitmap.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Sprite.js"></script>
    <script type="text/javascript" src="js/easeljs/display/BitmapAnimation.js"></script>
    <script type="text/javascript" src="js/easeljs/display/BitmapText.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Shape.js"></script>
    <script type="text/javascript" src="js/easeljs/display/Text.js"></script>
    <script type="text/javascript" src="js/easeljs/display/DOMElement.js"></script>
    <script type="text/javascript" src="js/easeljs/events/MouseEvent.js"></script>
    <script type="text/javascript" src="js/easeljs/filters/Filter.js"></script>
    <script type="text/javascript" src="js/easeljs/ui/ButtonHelper.js"></script>
    <script type="text/javascript" src="js/easeljs/ui/Touch.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/SpriteSheetUtils.js"></script>
    <script type="text/javascript" src="js/easeljs/utils/SpriteSheetBuilder.js"></script>

    <script type="text/javascript">
    var stage;
    var loader;
    var canvas;
    var viewport;
    var loader;

    var plane = {};

    var Vector = function Vector(x, y) {
        this.x = x || 0;
        this.y = y || 0;
    };

    Vector.prototype.add = function (otherVector) {
        this.x += otherVector.x || 0;
        this.y += otherVector.y || 0;

        return this;
    };

    Vector.prototype.cap = function (capTo) {
        this.x = this.x > capTo.x ? capTo.x : this.x;
        this.y = this.y > capTo.y ? capTo.y : this.y;

        return this;
    };

    var Entity = function Entity() {
        this._velocity = new Vector();

        this._acceleration = new Vector();
    };

    Entity.prototype.setVelocity = function (newVelocity) {
        this._velocity = newVelocity;
    };

    Entity.prototype.setMaxVelocity = function (maxVelocity) {
        this._maxVelocity = maxVelocity;
    };

    Entity.prototype.setAcceleration = function (newAcceleration) {
        this._acceleration = newAcceleration;
    };

    Entity.prototype.update = function () {
        this.asset.x = this.asset.x + this._velocity.x;
        this.asset.y = this.asset.y + this._velocity.y;

        this._velocity.add(this._acceleration).cap(this._maxVelocity);
    };

    var setupGame = function(stage) {
        canvas = stage.canvas;

        canvas = document.getElementById("travelatorCanvas");
        viewport = {
            dimensions: {
                x: window.innerWidth,
                y: window.innerHeight
            }
        };

        canvas.width = viewport.dimensions.x - 5;
        canvas.height = viewport.dimensions.y - 5;
    };

    var loadAssets = function(handleComplete) {
        var manifest = [{
            src: 'images/plane2small.png',
            id: 'plane'
        }];

        loader = new createjs.LoadQueue(false);
        loader.addEventListener('complete', handleComplete);
        loader.loadManifest(manifest);
    };

    var createPlane = function () {
        var plane = new Entity();

        var asset = plane.asset = new createjs.Bitmap(loader.getResult('plane'));
        asset.setTransform(viewport.dimensions.x - 100, viewport.dimensions.y, 0.2, 0.2);

        stage.addChild(asset);

        plane.setVelocity(new Vector(-3, -1));
        plane.setMaxVelocity(new Vector(-20, -5))
        plane.setAcceleration(new Vector(-0.2, -0.2));

        return plane;
    };

    var onTick = function (event) {
        plane.update();

        stage.update(event);
    };

    function init() {
        stage = new createjs.Stage("travelatorCanvas");
        setupGame(stage);

        loadAssets(function() {
            var square = new createjs.Shape();

            square.graphics.beginFill("#000000").drawRect(0, 0, viewport.dimensions.x, viewport.dimensions.y);

            stage.addChild(square);

            plane = createPlane();

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
            createjs.Ticker.addEventListener('tick', onTick);
        });
    }
    </script>
</head>

<body onload="init();">
    <div>
        <canvas id="travelatorCanvas"></canvas>

        <script src="/socket.io/socket.io.js"></script>
        <script>
        var socket = io.connect('/');
        socket.on('player', function(data) {
            console.log(data);
        });
        </script>
    </div>
</body>

</html>
